<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>mailbox — Manipulate Email Archives &mdash; PyMOTW 3</title>

    <link rel="stylesheet" href="../_static/pure-min.css" type="text/css">
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/font-awesome/css/font-awesome.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pymotw.css" type="text/css">

    <link rel="shortcut icon" type="image/png" href="../_static/favicon.png">

    <link rel="alternate" type="application/atom+xml"
          title="Doug Hellmann"
          href="http://feeds.doughellmann.com/DougHellmann" />
    <link rel="alternate" type="application/atom+xml"
          title="PyMOTW Updates"
          href="http://feeds.doughellmann.com/PyMOTW" />

    <meta name="verify-v1" content="5saTcOa2HLac4V85yUg3SARfun1PqT5Upu7IR/6fpv4="/>

  </head>
  <body>

    <div class="pure-menu pure-menu-open pure-menu-horizontal" id="site-menu">
      <a class="pure-menu-heading" href="../index.html"><img src="../_static/logo.png"> PyMOTW-3</a>

      <ul id="top-menu">
        <li class="pure-menu-selected"><a href="../py-modindex.html"><i class="fa fa-list fa-lg"></i> Module Index</a></li>
        <li class="pure-menu-selected"><a href="../genindex.html"><i class="fa fa-italic fa-lg"></i> Index</a></li>
        <li class="pure-menu-selected"><a class="sociallink" href="http://www.twitter.com/pymotw"
       title="Twitter">
      <i class="fa fa-twitter fa-lg"></i></a></a>
        <li class="pure-menu-selected"><a class="sociallink" href="http://feeds.doughellmann.com/PyMOTW"
       title="Subscribe via RSS">
      <i class="fa fa-rss-square fa-lg"></i></a></li>
      </ul>

    </div>

    <div class="pure-menu pure-menu-open pure-menu-vertical" id="breadcrumbs-menu">
      
      <ul id="breadcrumbs">
        <li class="pure-menu-selected"><a href="../email.html"><i class="fa fa-arrow-circle-up"></i> Email</a></li>
      </ul>
    </div>

    <div class="pure-g-r" id="content-container">

      <div class="pure-u-3-4">
        <div class="content">
          
  <div class="section" id="module-mailbox">
<span id="mailbox-manipulate-email-archives"></span><h1>mailbox — Manipulate Email Archives<a class="headerlink" href="#module-mailbox" title="Permalink to this headline">¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Purpose:</th><td class="field-body">Work with email messages in various local file formats.</td>
</tr>
</tbody>
</table>
<p>The <code class="docutils literal notranslate"><span class="pre">mailbox</span></code> module defines a common API for accessing email
messages stored in local disk formats, including:</p>
<ul class="simple">
<li>Maildir</li>
<li>mbox</li>
<li>MH</li>
<li>Babyl</li>
<li>MMDF</li>
</ul>
<p>There are base classes for <code class="docutils literal notranslate"><span class="pre">Mailbox</span></code> and <code class="docutils literal notranslate"><span class="pre">Message</span></code>, and
each mailbox format includes a corresponding pair of subclasses to
implement the details for that format.</p>
<div class="section" id="mbox">
<h2>mbox<a class="headerlink" href="#mbox" title="Permalink to this headline">¶</a></h2>
<p>The mbox format is the simplest to show in documentation, since it is
entirely plain text.  Each mailbox is stored as a single file, with
all of the messages concatenated together.  Each time a line starting
with <code class="docutils literal notranslate"><span class="pre">&quot;From</span> <span class="pre">&quot;</span></code> (“From” followed by a single space) is encountered it
is treated as the beginning of a new message.  Any time those
characters appear at the beginning of a line in the message body, they
are escaped by prefixing the line with <code class="docutils literal notranslate"><span class="pre">&quot;&gt;&quot;</span></code>.</p>
<div class="section" id="creating-an-mbox-mailbox">
<h3>Creating an mbox Mailbox<a class="headerlink" href="#creating-an-mbox-mailbox" title="Permalink to this headline">¶</a></h3>
<p>Instantiate the <code class="docutils literal notranslate"><span class="pre">mbox</span></code> class by passing the filename to the
constructor.  If the file does not exist, it is created when
<code class="docutils literal notranslate"><span class="pre">add()</span></code> is used to append messages.</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">mailbox_mbox_create.py</span><a class="headerlink" href="#id1" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mailbox</span>
<span class="kn">import</span> <span class="nn">email.utils</span>

<span class="n">from_addr</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">formataddr</span><span class="p">((</span><span class="s1">&#39;Author&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;author@example.com&#39;</span><span class="p">))</span>
<span class="n">to_addr</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">formataddr</span><span class="p">((</span><span class="s1">&#39;Recipient&#39;</span><span class="p">,</span>
                                  <span class="s1">&#39;recipient@example.com&#39;</span><span class="p">))</span>

<span class="n">payload</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;This is the body.</span>
<span class="s1">From (will not be escaped).</span>
<span class="s1">There are 3 lines.</span>
<span class="s1">&#39;&#39;&#39;</span>

<span class="n">mbox</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">mbox</span><span class="p">(</span><span class="s1">&#39;example.mbox&#39;</span><span class="p">)</span>
<span class="n">mbox</span><span class="o">.</span><span class="n">lock</span><span class="p">()</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">mboxMessage</span><span class="p">()</span>
    <span class="n">msg</span><span class="o">.</span><span class="n">set_unixfrom</span><span class="p">(</span><span class="s1">&#39;author Sat Feb  7 01:05:34 2009&#39;</span><span class="p">)</span>
    <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;From&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">from_addr</span>
    <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;To&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">to_addr</span>
    <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;Subject&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Sample message 1&#39;</span>
    <span class="n">msg</span><span class="o">.</span><span class="n">set_payload</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
    <span class="n">mbox</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="n">mbox</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

    <span class="n">msg</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">mboxMessage</span><span class="p">()</span>
    <span class="n">msg</span><span class="o">.</span><span class="n">set_unixfrom</span><span class="p">(</span><span class="s1">&#39;author&#39;</span><span class="p">)</span>
    <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;From&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">from_addr</span>
    <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;To&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">to_addr</span>
    <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;Subject&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Sample message 2&#39;</span>
    <span class="n">msg</span><span class="o">.</span><span class="n">set_payload</span><span class="p">(</span><span class="s1">&#39;This is the second body.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">mbox</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="n">mbox</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
<span class="k">finally</span><span class="p">:</span>
    <span class="n">mbox</span><span class="o">.</span><span class="n">unlock</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;example.mbox&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</pre></div>
</div>
</div>
<p>The result of this script is a new mailbox file with two email
messages.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 mailbox_mbox_create.py

From MAILER-DAEMON Sun Mar 18 20:20:59 2018
From: Author &lt;author@example.com&gt;
To: Recipient &lt;recipient@example.com&gt;
Subject: Sample message 1

This is the body.
&gt;From (will not be escaped).
There are 3 lines.

From MAILER-DAEMON Sun Mar 18 20:20:59 2018
From: Author &lt;author@example.com&gt;
To: Recipient &lt;recipient@example.com&gt;
Subject: Sample message 2

This is the second body.
</pre></div>
</div>
</div>
<div class="section" id="reading-an-mbox-mailbox">
<h3>Reading an mbox Mailbox<a class="headerlink" href="#reading-an-mbox-mailbox" title="Permalink to this headline">¶</a></h3>
<p>To read an existing mailbox, open it and treat the <code class="docutils literal notranslate"><span class="pre">mbox</span></code>
object like a dictionary.  The keys are arbitrary values defined by
the mailbox instance and are not necessary meaningful other than as
internal identifiers for message objects.</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">mailbox_mbox_read.py</span><a class="headerlink" href="#id2" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mailbox</span>

<span class="n">mbox</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">mbox</span><span class="p">(</span><span class="s1">&#39;example.mbox&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">message</span> <span class="ow">in</span> <span class="n">mbox</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">[</span><span class="s1">&#39;subject&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<p>The open mailbox supports the iterator protocol, but unlike true
dictionary objects the default iterator for a mailbox works on the
<em>values</em> instead of the <em>keys</em>.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 mailbox_mbox_read.py

Sample message 1
Sample message 2
</pre></div>
</div>
</div>
<div class="section" id="removing-messages-from-an-mbox-mailbox">
<h3>Removing Messages from an mbox Mailbox<a class="headerlink" href="#removing-messages-from-an-mbox-mailbox" title="Permalink to this headline">¶</a></h3>
<p>To remove an existing message from an mbox file, either use its key with
<code class="xref py py-meth docutils literal notranslate"><span class="pre">remove()</span></code> or use <code class="docutils literal notranslate"><span class="pre">del</span></code>.</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">mailbox_mbox_remove.py</span><a class="headerlink" href="#id3" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mailbox</span>

<span class="n">mbox</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">mbox</span><span class="p">(</span><span class="s1">&#39;example.mbox&#39;</span><span class="p">)</span>
<span class="n">mbox</span><span class="o">.</span><span class="n">lock</span><span class="p">()</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">to_remove</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">mbox</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="k">if</span> <span class="s1">&#39;2&#39;</span> <span class="ow">in</span> <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;subject&#39;</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Removing:&#39;</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
            <span class="n">to_remove</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">to_remove</span><span class="p">:</span>
        <span class="n">mbox</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<span class="k">finally</span><span class="p">:</span>
    <span class="n">mbox</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
    <span class="n">mbox</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;example.mbox&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
</pre></div>
</div>
</div>
<p>The <code class="xref py py-meth docutils literal notranslate"><span class="pre">lock()</span></code> and <code class="xref py py-meth docutils literal notranslate"><span class="pre">unlock()</span></code> methods are used to prevent issues
from simultaneous access to the file, and <code class="xref py py-meth docutils literal notranslate"><span class="pre">flush()</span></code> forces the
changes to be written to disk.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 mailbox_mbox_remove.py

Removing: 1
From MAILER-DAEMON Sun Mar 18 20:20:59 2018
From: Author &lt;author@example.com&gt;
To: Recipient &lt;recipient@example.com&gt;
Subject: Sample message 1

This is the body.
&gt;From (will not be escaped).
There are 3 lines.
</pre></div>
</div>
</div>
</div>
<div class="section" id="maildir">
<h2>Maildir<a class="headerlink" href="#maildir" title="Permalink to this headline">¶</a></h2>
<p>The Maildir format was created to eliminate the problem of concurrent
modification to an mbox file.  Instead of using a single file, the
mailbox is organized as directory where each message is contained in
its own file.  This also allows mailboxes to be nested, so the API
for a Maildir mailbox is extended with methods to work with
sub-folders.</p>
<div class="section" id="creating-a-maildir-mailbox">
<h3>Creating a Maildir Mailbox<a class="headerlink" href="#creating-a-maildir-mailbox" title="Permalink to this headline">¶</a></h3>
<p>The only real difference between creating a <code class="docutils literal notranslate"><span class="pre">Maildir</span></code> and
<code class="docutils literal notranslate"><span class="pre">mbox</span></code> is that the argument to the constructor is a directory
name instead of a file name.  As before, if the mailbox does not
exist, it is created when messages are added.</p>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">mailbox_maildir_create.py</span><a class="headerlink" href="#id4" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mailbox</span>
<span class="kn">import</span> <span class="nn">email.utils</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="n">from_addr</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">formataddr</span><span class="p">((</span><span class="s1">&#39;Author&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;author@example.com&#39;</span><span class="p">))</span>
<span class="n">to_addr</span> <span class="o">=</span> <span class="n">email</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">formataddr</span><span class="p">((</span><span class="s1">&#39;Recipient&#39;</span><span class="p">,</span>
                                  <span class="s1">&#39;recipient@example.com&#39;</span><span class="p">))</span>

<span class="n">payload</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;This is the body.</span>
<span class="s1">From (will not be escaped).</span>
<span class="s1">There are 3 lines.</span>
<span class="s1">&#39;&#39;&#39;</span>

<span class="n">mbox</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">Maildir</span><span class="p">(</span><span class="s1">&#39;Example&#39;</span><span class="p">)</span>
<span class="n">mbox</span><span class="o">.</span><span class="n">lock</span><span class="p">()</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">mboxMessage</span><span class="p">()</span>
    <span class="n">msg</span><span class="o">.</span><span class="n">set_unixfrom</span><span class="p">(</span><span class="s1">&#39;author Sat Feb  7 01:05:34 2009&#39;</span><span class="p">)</span>
    <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;From&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">from_addr</span>
    <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;To&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">to_addr</span>
    <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;Subject&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Sample message 1&#39;</span>
    <span class="n">msg</span><span class="o">.</span><span class="n">set_payload</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
    <span class="n">mbox</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="n">mbox</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>

    <span class="n">msg</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">mboxMessage</span><span class="p">()</span>
    <span class="n">msg</span><span class="o">.</span><span class="n">set_unixfrom</span><span class="p">(</span><span class="s1">&#39;author Sat Feb  7 01:05:34 2009&#39;</span><span class="p">)</span>
    <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;From&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">from_addr</span>
    <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;To&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">to_addr</span>
    <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;Subject&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Sample message 2&#39;</span>
    <span class="n">msg</span><span class="o">.</span><span class="n">set_payload</span><span class="p">(</span><span class="s1">&#39;This is the second body.</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">mbox</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="n">mbox</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
<span class="k">finally</span><span class="p">:</span>
    <span class="n">mbox</span><span class="o">.</span><span class="n">unlock</span><span class="p">()</span>

<span class="k">for</span> <span class="n">dirname</span><span class="p">,</span> <span class="n">subdirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="s1">&#39;Example&#39;</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">dirname</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  Directories:&#39;</span><span class="p">,</span> <span class="n">subdirs</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="n">fullname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">***&#39;</span><span class="p">,</span> <span class="n">fullname</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">fullname</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span> <span class="o">*</span> <span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>When messages are added to the mailbox, they go to the <code class="docutils literal notranslate"><span class="pre">new</span></code>
subdirectory.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Although it is safe to write to the same maildir from multiple
processes, <code class="xref py py-meth docutils literal notranslate"><span class="pre">add()</span></code> is not thread-safe.  Use a semaphore or
other locking device to prevent simultaneous modifications to the
mailbox from multiple threads of the same process.</p>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 mailbox_maildir_create.py

Example
  Directories: [&#39;new&#39;, &#39;cur&#39;, &#39;tmp&#39;]
Example/new
  Directories: []

*** Example/new/1521404460.M306174P41689Q2.hubert.local
From: Author &lt;author@example.com&gt;
To: Recipient &lt;recipient@example.com&gt;
Subject: Sample message 2

This is the second body.

********************

*** Example/new/1521404460.M303200P41689Q1.hubert.local
From: Author &lt;author@example.com&gt;
To: Recipient &lt;recipient@example.com&gt;
Subject: Sample message 1

This is the body.
From (will not be escaped).
There are 3 lines.

********************
Example/cur
  Directories: []
Example/tmp
  Directories: []
</pre></div>
</div>
<p>After they are read, a client could move them to the <code class="docutils literal notranslate"><span class="pre">cur</span></code>
subdirectory using the <code class="docutils literal notranslate"><span class="pre">set_subdir()</span></code> method of the
<code class="docutils literal notranslate"><span class="pre">MaildirMessage</span></code>.</p>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">mailbox_maildir_set_subdir.py</span><a class="headerlink" href="#id5" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mailbox</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Before:&#39;</span><span class="p">)</span>
<span class="n">mbox</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">Maildir</span><span class="p">(</span><span class="s1">&#39;Example&#39;</span><span class="p">)</span>
<span class="n">mbox</span><span class="o">.</span><span class="n">lock</span><span class="p">()</span>
<span class="k">try</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">message_id</span><span class="p">,</span> <span class="n">message</span> <span class="ow">in</span> <span class="n">mbox</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:6}</span><span class="s1"> &quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">get_subdir</span><span class="p">(),</span>
                                 <span class="n">message</span><span class="p">[</span><span class="s1">&#39;subject&#39;</span><span class="p">]))</span>
        <span class="n">message</span><span class="o">.</span><span class="n">set_subdir</span><span class="p">(</span><span class="s1">&#39;cur&#39;</span><span class="p">)</span>
        <span class="c1"># Tell the mailbox to update the message.</span>
        <span class="n">mbox</span><span class="p">[</span><span class="n">message_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">message</span>
<span class="k">finally</span><span class="p">:</span>
    <span class="n">mbox</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
    <span class="n">mbox</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">After:&#39;</span><span class="p">)</span>
<span class="n">mbox</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">Maildir</span><span class="p">(</span><span class="s1">&#39;Example&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">message</span> <span class="ow">in</span> <span class="n">mbox</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:6}</span><span class="s1"> &quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">get_subdir</span><span class="p">(),</span>
                             <span class="n">message</span><span class="p">[</span><span class="s1">&#39;subject&#39;</span><span class="p">]))</span>

<span class="nb">print</span><span class="p">()</span>
<span class="k">for</span> <span class="n">dirname</span><span class="p">,</span> <span class="n">subdirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="s1">&#39;Example&#39;</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">dirname</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  Directories:&#39;</span><span class="p">,</span> <span class="n">subdirs</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="n">fullname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">fullname</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Although a maildir includes a “<code class="docutils literal notranslate"><span class="pre">tmp</span></code>” directory, the only valid
arguments for <code class="docutils literal notranslate"><span class="pre">set_subdir()</span></code> are “<code class="docutils literal notranslate"><span class="pre">cur</span></code>” and “<code class="docutils literal notranslate"><span class="pre">new</span></code>”.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 mailbox_maildir_set_subdir.py

Before:
new    &quot;Sample message 2&quot;
new    &quot;Sample message 1&quot;

After:
cur    &quot;Sample message 2&quot;
cur    &quot;Sample message 1&quot;

Example
  Directories: [&#39;new&#39;, &#39;cur&#39;, &#39;tmp&#39;]
Example/new
  Directories: []
Example/cur
  Directories: []
Example/cur/1521404460.M306174P41689Q2.hubert.local
Example/cur/1521404460.M303200P41689Q1.hubert.local
Example/tmp
  Directories: []
</pre></div>
</div>
</div>
<div class="section" id="reading-a-maildir-mailbox">
<h3>Reading a Maildir Mailbox<a class="headerlink" href="#reading-a-maildir-mailbox" title="Permalink to this headline">¶</a></h3>
<p>Reading from an existing Maildir mailbox works just like an mbox
mailbox.</p>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text">mailbox_maildir_read.py</span><a class="headerlink" href="#id6" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mailbox</span>

<span class="n">mbox</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">Maildir</span><span class="p">(</span><span class="s1">&#39;Example&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">message</span> <span class="ow">in</span> <span class="n">mbox</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">message</span><span class="p">[</span><span class="s1">&#39;subject&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<p>The messages are not guaranteed to be read in any particular order.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 mailbox_maildir_read.py

Sample message 2
Sample message 1
</pre></div>
</div>
</div>
<div class="section" id="removing-messages-from-a-maildir-mailbox">
<h3>Removing Messages from a Maildir Mailbox<a class="headerlink" href="#removing-messages-from-a-maildir-mailbox" title="Permalink to this headline">¶</a></h3>
<p>To remove an existing message from a Maildir mailbox, either pass its
key to <code class="xref py py-meth docutils literal notranslate"><span class="pre">remove()</span></code> or use <code class="docutils literal notranslate"><span class="pre">del</span></code>.</p>
<div class="literal-block-wrapper docutils container" id="id7">
<div class="code-block-caption"><span class="caption-text">mailbox_maildir_remove.py</span><a class="headerlink" href="#id7" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mailbox</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="n">mbox</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">Maildir</span><span class="p">(</span><span class="s1">&#39;Example&#39;</span><span class="p">)</span>
<span class="n">mbox</span><span class="o">.</span><span class="n">lock</span><span class="p">()</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">to_remove</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">mbox</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="k">if</span> <span class="s1">&#39;2&#39;</span> <span class="ow">in</span> <span class="n">msg</span><span class="p">[</span><span class="s1">&#39;subject&#39;</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Removing:&#39;</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
            <span class="n">to_remove</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">to_remove</span><span class="p">:</span>
        <span class="n">mbox</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<span class="k">finally</span><span class="p">:</span>
    <span class="n">mbox</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
    <span class="n">mbox</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="k">for</span> <span class="n">dirname</span><span class="p">,</span> <span class="n">subdirs</span><span class="p">,</span> <span class="n">files</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">walk</span><span class="p">(</span><span class="s1">&#39;Example&#39;</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">dirname</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  Directories:&#39;</span><span class="p">,</span> <span class="n">subdirs</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">files</span><span class="p">:</span>
        <span class="n">fullname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirname</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">***&#39;</span><span class="p">,</span> <span class="n">fullname</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">fullname</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span> <span class="o">*</span> <span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>There is no way to compute the key for a message, so use <code class="xref py py-meth docutils literal notranslate"><span class="pre">items()</span></code>
or <code class="xref py py-meth docutils literal notranslate"><span class="pre">iteritems()</span></code> to retrieve the key and message object from the
mailbox at the same time.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 mailbox_maildir_remove.py

Removing: 1521404460.M306174P41689Q2.hubert.local
Example
  Directories: [&#39;new&#39;, &#39;cur&#39;, &#39;tmp&#39;]
Example/new
  Directories: []
Example/cur
  Directories: []

*** Example/cur/1521404460.M303200P41689Q1.hubert.local
From: Author &lt;author@example.com&gt;
To: Recipient &lt;recipient@example.com&gt;
Subject: Sample message 1

This is the body.
From (will not be escaped).
There are 3 lines.

********************
Example/tmp
  Directories: []
</pre></div>
</div>
</div>
<div class="section" id="maildir-folders">
<h3>Maildir folders<a class="headerlink" href="#maildir-folders" title="Permalink to this headline">¶</a></h3>
<p>Subdirectories or <em>folders</em> of a Maildir mailbox can be managed
directly through the methods of the <code class="docutils literal notranslate"><span class="pre">Maildir</span></code> class.  Callers
can list, retrieve, create, and remove sub-folders for a given
mailbox.</p>
<div class="literal-block-wrapper docutils container" id="id8">
<div class="code-block-caption"><span class="caption-text">mailbox_maildir_folders.py</span><a class="headerlink" href="#id8" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mailbox</span>
<span class="kn">import</span> <span class="nn">os</span>


<span class="k">def</span> <span class="nf">show_maildir</span><span class="p">(</span><span class="n">name</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;find </span><span class="si">{}</span><span class="s1"> -print&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>


<span class="n">mbox</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">Maildir</span><span class="p">(</span><span class="s1">&#39;Example&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Before:&#39;</span><span class="p">,</span> <span class="n">mbox</span><span class="o">.</span><span class="n">list_folders</span><span class="p">())</span>
<span class="n">show_maildir</span><span class="p">(</span><span class="s1">&#39;Example&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="si">{:#^30}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">))</span>

<span class="n">mbox</span><span class="o">.</span><span class="n">add_folder</span><span class="p">(</span><span class="s1">&#39;subfolder&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;subfolder created:&#39;</span><span class="p">,</span> <span class="n">mbox</span><span class="o">.</span><span class="n">list_folders</span><span class="p">())</span>
<span class="n">show_maildir</span><span class="p">(</span><span class="s1">&#39;Example&#39;</span><span class="p">)</span>

<span class="n">subfolder</span> <span class="o">=</span> <span class="n">mbox</span><span class="o">.</span><span class="n">get_folder</span><span class="p">(</span><span class="s1">&#39;subfolder&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;subfolder contents:&#39;</span><span class="p">,</span> <span class="n">subfolder</span><span class="o">.</span><span class="n">list_folders</span><span class="p">())</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="si">{:#^30}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">))</span>

<span class="n">subfolder</span><span class="o">.</span><span class="n">add_folder</span><span class="p">(</span><span class="s1">&#39;second_level&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;second_level created:&#39;</span><span class="p">,</span> <span class="n">subfolder</span><span class="o">.</span><span class="n">list_folders</span><span class="p">())</span>
<span class="n">show_maildir</span><span class="p">(</span><span class="s1">&#39;Example&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="si">{:#^30}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">))</span>

<span class="n">subfolder</span><span class="o">.</span><span class="n">remove_folder</span><span class="p">(</span><span class="s1">&#39;second_level&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;second_level removed:&#39;</span><span class="p">,</span> <span class="n">subfolder</span><span class="o">.</span><span class="n">list_folders</span><span class="p">())</span>
<span class="n">show_maildir</span><span class="p">(</span><span class="s1">&#39;Example&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The directory name for the folder is constructed by prefixing the
folder name with a period (<code class="docutils literal notranslate"><span class="pre">.</span></code>).</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 mailbox_maildir_folders.py

Example
Example/new
Example/cur
Example/cur/1521404460.M303200P41689Q1.hubert.local
Example/tmp
Example
Example/.subfolder
Example/.subfolder/maildirfolder
Example/.subfolder/new
Example/.subfolder/cur
Example/.subfolder/tmp
Example/new
Example/cur
Example/cur/1521404460.M303200P41689Q1.hubert.local
Example/tmp
Example
Example/.subfolder
Example/.subfolder/.second_level
Example/.subfolder/.second_level/maildirfolder
Example/.subfolder/.second_level/new
Example/.subfolder/.second_level/cur
Example/.subfolder/.second_level/tmp
Example/.subfolder/maildirfolder
Example/.subfolder/new
Example/.subfolder/cur
Example/.subfolder/tmp
Example/new
Example/cur
Example/cur/1521404460.M303200P41689Q1.hubert.local
Example/tmp
Example
Example/.subfolder
Example/.subfolder/maildirfolder
Example/.subfolder/new
Example/.subfolder/cur
Example/.subfolder/tmp
Example/new
Example/cur
Example/cur/1521404460.M303200P41689Q1.hubert.local
Example/tmp
Before: []

##############################

subfolder created: [&#39;subfolder&#39;]
subfolder contents: []

##############################

second_level created: [&#39;second_level&#39;]

##############################

second_level removed: []
</pre></div>
</div>
</div>
</div>
<div class="section" id="message-flags">
<h2>Message Flags<a class="headerlink" href="#message-flags" title="Permalink to this headline">¶</a></h2>
<p>Messages in mailboxes have flags for tracking aspects such as whether
or not the message has been read, flagged as important by the reader,
or marked for deletion later. Flags are stored as a sequence of
format-specific letter codes and the <code class="docutils literal notranslate"><span class="pre">Message</span></code> classes have
methods to retrieve and change the values of the flags. This example
shows the flags on the messages in the <code class="docutils literal notranslate"><span class="pre">Example</span></code> maildir before
adding the flag to indicate that the message is considered important.</p>
<div class="literal-block-wrapper docutils container" id="id9">
<div class="code-block-caption"><span class="caption-text">mailbox_maildir_add_flag.py</span><a class="headerlink" href="#id9" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mailbox</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Before:&#39;</span><span class="p">)</span>
<span class="n">mbox</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">Maildir</span><span class="p">(</span><span class="s1">&#39;Example&#39;</span><span class="p">)</span>
<span class="n">mbox</span><span class="o">.</span><span class="n">lock</span><span class="p">()</span>
<span class="k">try</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">message_id</span><span class="p">,</span> <span class="n">message</span> <span class="ow">in</span> <span class="n">mbox</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:6}</span><span class="s1"> &quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">get_flags</span><span class="p">(),</span>
                                 <span class="n">message</span><span class="p">[</span><span class="s1">&#39;subject&#39;</span><span class="p">]))</span>
        <span class="n">message</span><span class="o">.</span><span class="n">add_flag</span><span class="p">(</span><span class="s1">&#39;F&#39;</span><span class="p">)</span>
        <span class="c1"># Tell the mailbox to update the message.</span>
        <span class="n">mbox</span><span class="p">[</span><span class="n">message_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">message</span>
<span class="k">finally</span><span class="p">:</span>
    <span class="n">mbox</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
    <span class="n">mbox</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">After:&#39;</span><span class="p">)</span>
<span class="n">mbox</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">Maildir</span><span class="p">(</span><span class="s1">&#39;Example&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">message</span> <span class="ow">in</span> <span class="n">mbox</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:6}</span><span class="s1"> &quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">get_flags</span><span class="p">(),</span>
                             <span class="n">message</span><span class="p">[</span><span class="s1">&#39;subject&#39;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<p>By default messages have no flags. Adding a flag changes the message
in memory, but does not update the message on disk. To update the
message on disk store the message object in the mailbox using its
existing identifier.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 mailbox_maildir_add_flag.py

Before:
       &quot;Sample message 1&quot;

After:
F      &quot;Sample message 1&quot;
</pre></div>
</div>
<p>Adding flags with <code class="docutils literal notranslate"><span class="pre">add_flag()</span></code> preserves any existing flags. Using
<code class="docutils literal notranslate"><span class="pre">set_flags()</span></code> writes over any existing set of flags, replacing it
with the new values passed to the method.</p>
<div class="literal-block-wrapper docutils container" id="id10">
<div class="code-block-caption"><span class="caption-text">mailbox_maildir_set_flags.py</span><a class="headerlink" href="#id10" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mailbox</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Before:&#39;</span><span class="p">)</span>
<span class="n">mbox</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">Maildir</span><span class="p">(</span><span class="s1">&#39;Example&#39;</span><span class="p">)</span>
<span class="n">mbox</span><span class="o">.</span><span class="n">lock</span><span class="p">()</span>
<span class="k">try</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">message_id</span><span class="p">,</span> <span class="n">message</span> <span class="ow">in</span> <span class="n">mbox</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:6}</span><span class="s1"> &quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">get_flags</span><span class="p">(),</span>
                                 <span class="n">message</span><span class="p">[</span><span class="s1">&#39;subject&#39;</span><span class="p">]))</span>
        <span class="n">message</span><span class="o">.</span><span class="n">set_flags</span><span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">)</span>
        <span class="c1"># Tell the mailbox to update the message.</span>
        <span class="n">mbox</span><span class="p">[</span><span class="n">message_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">message</span>
<span class="k">finally</span><span class="p">:</span>
    <span class="n">mbox</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
    <span class="n">mbox</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">After:&#39;</span><span class="p">)</span>
<span class="n">mbox</span> <span class="o">=</span> <span class="n">mailbox</span><span class="o">.</span><span class="n">Maildir</span><span class="p">(</span><span class="s1">&#39;Example&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">message</span> <span class="ow">in</span> <span class="n">mbox</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{:6}</span><span class="s1"> &quot;</span><span class="si">{}</span><span class="s1">&quot;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">get_flags</span><span class="p">(),</span>
                             <span class="n">message</span><span class="p">[</span><span class="s1">&#39;subject&#39;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">F</span></code> flag added by the previous example is lost when
<code class="docutils literal notranslate"><span class="pre">set_flags()</span></code> replaces the flags with <code class="docutils literal notranslate"><span class="pre">S</span></code> in this example.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ python3 mailbox_maildir_set_flags.py

Before:
F      &quot;Sample message 1&quot;

After:
S      &quot;Sample message 1&quot;
</pre></div>
</div>
</div>
<div class="section" id="other-formats">
<h2>Other Formats<a class="headerlink" href="#other-formats" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">mailbox</span></code> supports a few other formats, but none are as
popular as mbox or Maildir.  MH is another multi-file mailbox format
used by some mail handlers.  Babyl and MMDF are single-file formats
with different message separators than mbox.  The single-file formats
support the same API as mbox, and MH includes the folder-related
methods found in the Maildir class.</p>
<div class="admonition seealso">
<p class="first admonition-title">See also</p>
<ul class="last simple">
<li><a class="reference external" href="https://docs.python.org/3.7/library/mailbox.html">Standard library documentation for mailbox</a></li>
<li><a class="reference internal" href="../porting_notes.html#porting-mailbox"><span class="std std-ref">Python 2 to 3 porting notes for mailbox</span></a></li>
<li><a class="reference external" href="http://www.qmail.org/man/man5/mbox.html">mbox manpage from qmail</a> – Documentation for
the mbox format.</li>
<li><a class="reference external" href="http://www.qmail.org/man/man5/maildir.html">Maildir manpage from qmail</a> – Documentation
for the Maildir format.</li>
<li><code class="xref py py-mod docutils literal notranslate"><span class="pre">email</span></code> – The <code class="docutils literal notranslate"><span class="pre">email</span></code> module.</li>
<li><a class="reference internal" href="../imaplib/index.html#module-imaplib" title="imaplib: IMAP4 client library"><code class="xref py py-mod docutils literal notranslate"><span class="pre">imaplib</span></code></a> – The <code class="docutils literal notranslate"><span class="pre">imaplib</span></code> module can work with saved
email messages on an IMAP server.</li>
</ul>
</div>
</div>
</div>



        <div id="footer-nav">
<a id="prev-link" href="../smtpd/index.html"
   title="previous chapter"><i class="fa fa-arrow-circle-left"></i> smtpd — Sample Mail Servers</a>
<a id="next-link" href="../imaplib/index.html"
   title="next chapter">imaplib — IMAP4 Client Library <i class="fa fa-arrow-circle-right"></i></a>
        </div>

        </div>
      </div>

      <div class="pure-u-1-4">
        <div class="sidebar-wrapper">
          <div class="sidebar">
<div id="sidebar-toc">
  <h5>Quick Links</h5>
  <ul>
    
    <li><a href="#mbox"><i class="fa fa-caret-right"></i>mbox</a></li>
    
    <li><a href="#creating-an-mbox-mailbox"><i class="fa fa-caret-right"></i>Creating an mbox Mailbox</a></li>
    
    <li><a href="#reading-an-mbox-mailbox"><i class="fa fa-caret-right"></i>Reading an mbox Mailbox</a></li>
    
    <li><a href="#removing-messages-from-an-mbox-mailbox"><i class="fa fa-caret-right"></i>Removing Messages from an mbox Mailbox</a></li>
    
    <li><a href="#maildir"><i class="fa fa-caret-right"></i>Maildir</a></li>
    
    <li><a href="#creating-a-maildir-mailbox"><i class="fa fa-caret-right"></i>Creating a Maildir Mailbox</a></li>
    
    <li><a href="#reading-a-maildir-mailbox"><i class="fa fa-caret-right"></i>Reading a Maildir Mailbox</a></li>
    
    <li><a href="#removing-messages-from-a-maildir-mailbox"><i class="fa fa-caret-right"></i>Removing Messages from a Maildir Mailbox</a></li>
    
    <li><a href="#maildir-folders"><i class="fa fa-caret-right"></i>Maildir folders</a></li>
    
    <li><a href="#message-flags"><i class="fa fa-caret-right"></i>Message Flags</a></li>
    
    <li><a href="#other-formats"><i class="fa fa-caret-right"></i>Other Formats</a></li>
    
  </ul>
</div>

          </div>
          <div class="sidebar"><div id="sidebar-last-updated">
  This page was last updated 2018-03-18.
</div>

          </div>
          <div class="sidebar">
<div id="sidebar-nav">
  <h5>Navigation</h5>
  <ul>
    <li><a href="../smtpd/index.html"
           title="previous chapter"><i class="fa fa-arrow-circle-left"></i>smtpd — Sample Mail Servers</a></li>
    <li><a href="../imaplib/index.html"
           title="next chapter"><i class="fa fa-arrow-circle-right"></i>imaplib — IMAP4 Client Library</a></li>
  </ul>
</div>
          </div>
          <div class="sidebar"><div id="sidebar-book"><a target="new" href="https://doughellmann.com/blog/the-python-3-standard-library-by-example/"><img src="../_static/book-cover-image-med.jpg"><br>Get the book</a></div>
          </div>
          <div class="sidebar"><div id="sidebar-example-disclaimer">
<p>The output from all the example programs
from PyMOTW-3 has been generated with Python 3.7.9, unless
otherwise noted. Some of the features described here may not be
available in earlier versions of Python.</p>
<p>Looking for <a href="/2/">examples for Python 2</a>?</p>
</div>
          </div>

        </div>
      </div>

    </div>

    <div class="pure-g-r" id="footer">

      <div class="pure-u-1-3">
        <div class="footer-list">
            <h4>This Site</h4>
            <ul>
              <li><a href="../py-modindex.html"><i class="fa fa-list fa-lg"></i> Module Index</a></li>
              <li><a href="../genindex.html"><i class="fa fa-italic fa-lg"></i> Index</a></li>
            </ul>
        </div>
      </div><div class="pure-u-1-3">
          <div class="footer-content">
            <div class="socialmedia">
              <a class="sociallink" href="../index.html"
       title="Home">
      <i class="fa fa-home fa-lg"></i></a>
              <a class="sociallink" href="../about.html"
       title="About">
      <i class="fa fa-user fa-lg"></i></a>
              <a class="sociallink" href="http://www.twitter.com/pymotw"
       title="Twitter">
      <i class="fa fa-twitter fa-lg"></i></a>
              <a class="sociallink" href="http://feeds.doughellmann.com/PyMOTW"
       title="Subscribe via RSS">
      <i class="fa fa-rss-square fa-lg"></i></a>
              <a class="sociallink" href="http://feedburner.google.com/fb/a/mailverify?uri=PyMOTW&amp;loc=en_US"
       title="Subscribe via Email">
      <i class="fa fa-envelope fa-lg"></i></a>
            </div>

            <div class="copyright">
              <a rel="author" href="../about.html">&copy; Copyright 2021, Doug Hellmann</a>
            </div>

            <div class="cc"><a href="http://creativecommons.org/licenses/by-nc-sa/4.0/deed.en_US" rel="license"><img alt="Creative Commons License BY-NC-SA" style="border-width:0; align: center;" width="88" height="31" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFgAAAAfCAMAAABUFvrSAAAABGdBTUEAALGOfPtRkwAAAf5QTFRF////////////AAAADQwNDQ4NDg4OEBAQGRkZGxsbHxscICAgIx8gJCQkKCUmKCgoKCkoKSkpKSopKicnKioqLS0tMDAwMS0uMjExMjMxNTY1Pj8+Pzc5Pzs8QEBAQ0RDUFBQUFFQWldYXV5dYGBgY19haGVmbmxscHBwcHJvdXJzdnN0eHV2eXx5en15fH98fX98fnt8f4F+gICAgoWChIGChIWEhIaEh4aHiYyJjIqLjoeLj4+PkY+PkZORkZSRk5iTlZmUlpmWmJaXmpiZnp2dnqCdn5aan5+fn6Oeoqaho6Gho6ijpqqmq7GqrKurrLKrrbOsrrOtrrStr6+vr7Kvr7Sur7WusLOvsLWvsLavsbewsrexsrixs7iytLmztLqztbW1tbq0tru1t7y2uL23ub64ub65urm5ur+5ur+6u8C6u8C7vMC8vMG7vMG8vcK8vcK9vsK9vsO+v7+/v8O+v8S+wMS/wMW/wMXAwcXAwsfCw8fCw8jDxMfDxMjDxMnExcnExcnFxsrFxsrGx8vHyMfHyMzHyMzIycjIyc3Iyc3Jys3Jy8rLy87Ky8/Ky8/LzM/LzNDLzNDMzdDMzdHMzdHNztHNztLOz8/Pz9PP0NPP0NTQ0dTQ0dTR0tXR0tXS09bS1tXV39/f4N/g4+Pj6Ofn7+/v8fHx////rrSdFQAAAAN0Uk5TAAoO5yEBUwAAA+FJREFUSMe1lo9301QUx6uXUmaf0qJ26iTrRoVinUzjQNR1gAyH6Lqx6XTDoVvXbU7qhA5m7CgYWaTDlLa6AiFsba3t+y+9Sdr8OvVMi7zTnLTf5H7ee9/73n11PA1PpDkcADPRWPwKt8YLG2I2n89m7gh8iluJz0dnpqe+HBsdHRn+7w3JyF1cvpbk05mCJG8Xi9uPpMLdNJ9cXV5UyBNjoyMtkR2A3B9Tt8SCfLTTqUzC2XlMvpcRbnA/IPmryYnzoyM9XuWBt8eI21FBcAy5Qk4KtxkGtQ1I+fRNbnk+evHC5NhJDwATDDIAnhNa1ImdFQTHr6WEvNyFPFeATSTYgAu/dl3/I31jNR6bnZ76eDf4yxRb2Q+71aiz/0JB8JXkrZzCdbFVqrUhRHuu54XkytLczAUvBFADUB6ARwnyqEp/t02prK9XdAXBHC9KyPWVqd6qPhyzlOG55dhsL/hLDTD1A3rYAy+dRu6eXaGKruA75wi2hbqigNd+LYSRW6XUSh64l05dXYruA1OPZfAOD3vhObL/ILDvQkRXynSdvPpaiJB+TVHAfEZuA9d9amlVF7TJd3nu+xgwyu8AqNOnDGAM8/obOLhQpWQotPYReZ/SQdKuKQpY2DwKwFJbGwI4VhCSlxchSFUnNC+CCgaV9RAKoZKh1J4le9FmQv5SFQW88aATXGhEws8wrHb7AANc0CndQS+ag5ERaieke0FXvnkxoYL/1MGi7FSmmVBXMDOu3gLK5J2PMjdXv2tmBX6pDdKSkq39DWXh3G1KI4QYVmS3AHCIPnCXE+4hHy6PcfeQ6sV2lufiL2jJ0wasp4p2k/Z2CEXeeqahDBLS1/c8+dBIXq4IkFAiWQ1QtxtnUMz/wsXfBj+1LzdUKn17dvXXzEqfMoFDNWO57QCe22dskKB5g7zXbVN+i0RKumKxonrfzaIVys2wYu7TVrd0PXn1rOnJC4JTFjF5c19/gnXLFwj6jJJz1rOjoi63LnBRfbmNM+qNunG5baSufhu9OPX5my2VTWEzrHrRbIP8dHl+dnpyrIVDBME/q1u6/E9bGmt9i2AsQmeaFaFwIb22soSlfuL8SEtgOCJKB5BsKkNltWyK7zzWMY3X4exDc6GvsljoX5FzR+BxwdCbf3jAdjTJv5/S39H2B2iXpmgXpWB7iVrB0JuVzpgP07CUO2WKqX+oiVL/benKImhgOIzHf7hx/A/IBdHsQ6Nsmruilo4afVFqB8PLn2U2H8hbxeKWjH9YvuiwxNiMaNhALZptCg5d7zh+Sczmclnx0vEOax6ajdjucSMPTcD/97/Cp54Q929ZZbgcR3o0hAAAAABJRU5ErkJggg=="/></a>
            </div>

          </div></div><div class="pure-u-1-3">
          <div class="footer-list">
            <h4>Other Writing</h4>
            <ul>
              <li><a href="https://doughellmann.com/"><i class="fa fa-pencil fa-lg"></i> Blog</a></li>
              <li><a href="https://doughellmann.com/blog/the-python-standard-library-by-example/"><i class="fa fa-book fa-lg"></i> The Python Standard Library By Example</a></li>
            </ul>
          </div>
        </div><script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-38546875-3', 'pymotw.com');
  ga('send', 'pageview');
</script>

  </body>
</html>